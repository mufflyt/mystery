<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Geocoding • tyler</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Geocoding">
<meta property="og:description" content="A function to geocode addresses.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tyler</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/create_isochrones.html">Gathering Drive Time Isochrones</a>
    </li>
    <li>
      <a href="../articles/geocode.html">Geocoding</a>
    </li>
    <li>
      <a href="../articles/get_census_data.html">Getting Data from the US Census Bureau for Isochrones</a>
    </li>
    <li>
      <a href="../articles/my-vignette.html">Searching the NPI Database Starting with Taxonomy Codes</a>
    </li>
    <li>
      <a href="../articles/search_and_process_npi.html">Search and Process NPI Numbers</a>
    </li>
    <li>
      <a href="../articles/validate_and_remove_invalid_npi.html">Gather Physician Data Starting With NPI Numbers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Geocoding</h1>
                        <h4 data-toc-skip class="author">Tyler Muffly,
MD</h4>
            
      

      <div class="hidden name"><code>geocode.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>geocode</code> function is designed to help you geocode
datasets containing addresses and change them to lattitude and
longitude.</p>
<div class="section level3">
<h3 id="step-1">Step 1<a class="anchor" aria-label="anchor" href="#step-1"></a>
</h3>
<div class="section level4">
<h4 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p>Before you can harness the power of the
<code>search_by_taxonomy</code> function, it is essential to ensure that
you have the <code>tyler</code> package installed. You can effortlessly
install it using the following command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mufflyt.github.io/tyler/" class="external-link">tyler</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-usage">Example Usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h2>
<div class="section level3">
<h3 id="understanding-geocoding">Understanding Geocoding<a class="anchor" aria-label="anchor" href="#understanding-geocoding"></a>
</h3>
<p>Certainly! Geocoding, the process of converting addresses or place
names into geographic coordinates (latitude and longitude), has its
advantages and disadvantages. Here’s an overview of the pluses and
minuses of geocoding:</p>
<p><strong>Pluses of Geocoding:</strong></p>
<ul>
<li><ol style="list-style-type: decimal">
<li>
<strong>Location Accuracy:</strong> Geocoding provides precise
location information, allowing you to pinpoint addresses or places on a
map with high accuracy. This is crucial for various applications such as
mapping, navigation, and location-based services.</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>
<strong>Spatial Analysis:</strong> Geocoded data enables spatial
analysis, allowing you to perform tasks like proximity analysis, spatial
clustering, and spatial interpolation. It’s invaluable for geographic
information systems (GIS) and geographic research.</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>
<strong>Geographic Visualization:</strong> Geocoded data can be
visualized on maps, making it easier to understand and communicate
spatial patterns and trends. This is particularly useful for data
presentation and decision-making.</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>
<strong>Routing and Navigation:</strong> Geocoding is essential for
navigation systems, delivery route optimization, and location-based apps
that provide directions and estimated travel times.</li>
</ol></li>
</ul>
<p><strong>Minuses of Geocoding:</strong></p>
<ul>
<li><ol style="list-style-type: decimal">
<li>
<strong>Data Quality Issues:</strong> Geocoding accuracy heavily
relies on the quality of the underlying address data. Inaccurate or
outdated address information can lead to geocoding errors.</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>
<strong>Costs:</strong> Geocoding services or software often come
with associated costs, particularly for large-scale geocoding
operations. These costs can include data licensing fees and usage
charges.</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>
<strong>Complexity:</strong> Advanced geocoding tasks, such as
reverse geocoding (converting coordinates to addresses) and batch
geocoding, can be technically complex and may require expertise or
specialized tools.</li>
</ol></li>
</ul>
<p>In summary, geocoding offers numerous benefits in terms of location
accuracy, spatial analysis, visualization, and navigation. However, it
also comes with challenges related to data quality, costs, and
complexity. Careful consideration of these factors is essential when
using geocoding in various applications.</p>
<p><strong>Do not geocode from Zip codes</strong> There are several
issues and limitations associated with geocoding solely based on zip
codes:</p>
<ul>
<li><p>Lack of Precision: Zip codes are designed to cover a group of
addresses or an area, not specific points. Therefore, geocoding based
solely on a zip code provides only an approximation of the location,
often at the center or centroid of the zip code area. This lack of
precision can be problematic for applications that require accurate
coordinates.</p></li>
<li><p>Zip Code Boundaries: Zip code boundaries can be irregular and may
not align with natural or administrative boundaries. This means that
geocoding based on zip codes can result in coordinates that do not
reflect the actual geography of the area, leading to
inaccuracies.</p></li>
<li><p>Zip Code Changes: Zip code boundaries and assignments can change
over time due to population growth, urban development, or administrative
reasons. Geocoding based on outdated zip code data can lead to incorrect
locations.</p></li>
<li><p>Large Zip Codes: Some zip codes cover vast geographic areas,
especially in rural regions. Geocoding to the center of such large zip
code areas can be highly inaccurate for specific locations within that
area.</p></li>
<li><p>Overlapping Zip Codes: In some cases, zip codes may overlap with
one another. Geocoding based solely on a zip code may not distinguish
between the overlapping areas, leading to ambiguity.</p></li>
<li><p>Urban Density: In densely populated urban areas, zip codes can be
small and densely packed with addresses. Geocoding solely by zip code
may still result in a lack of precision when trying to identify a
particular location within a zip code.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="step-2-prepare-your-data">Step 2: Prepare Your Data<a class="anchor" aria-label="anchor" href="#step-2-prepare-your-data"></a>
</h3>
<p>You can provide your data as either a dataframe or a CSV file in the
argument <code>input_data</code>. Under the hood
<code><a href="https://rdrr.io/pkg/ggmap/man/geocode.html" class="external-link">ggmap::geocode</a></code> is accessing a Google API.
<code><a href="https://rdrr.io/pkg/ggmap/man/geocode.html" class="external-link">ggmap::geocode</a></code> is the program AHRQ uses.</p>
<ul>
<li>If your data is in a CSV file, pass the file path as the input_data
parameter.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_data</span> <span class="op">&lt;-</span> <span class="fu">geocode_unique_addresses</span><span class="op">(</span></span>
<span>    file_path <span class="op">=</span><span class="st">"address_for_geocoding.csv"</span>,</span>
<span>    google_maps_api_key <span class="op">=</span> <span class="st">"123"</span>,</span>
<span>    output_file_path <span class="op">=</span> <span class="st">"data/geocoded_unique_addresses.csv"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Sometimes the data needs to have separate <code>lat</code> and
<code>long</code> columns. This code can do that:</li>
</ul>
<pre><code><span><span class="va">geocoded_data1</span> <span class="op">&lt;-</span> <span class="va">geocoded_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>, <span class="st">"Y"</span><span class="op">]</span>,</span>
<span>               long <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>, <span class="st">"X"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<ul>
<li><p>How do you match the <code>geocoded_data</code> with the orginal
dataframe? You can use the <code>postmastr</code> package that allows
the addresses in both dataframes to be parsed into house number, street,
state, etc. Once in their individual parts you can do a join together.
This seems janky af.</p></li>
<li><p>postmast’s functionality rests on an order of operations that
must be followed to ensure correct parsing:</p></li>
<li><p>prep</p></li>
<li><p>postal code</p></li>
<li><p>state</p></li>
<li><p>city</p></li>
<li><p>unit</p></li>
<li><p>house number</p></li>
<li><p>ranged house number</p></li>
<li><p>fractional house number</p></li>
<li><p>house suffix</p></li>
<li><p>street directionals</p></li>
<li><p>street suffix</p></li>
<li><p>street name</p></li>
<li><p>reconstruct</p></li>
</ul>
<pre><code><span><span class="co"># install.packages("remotes")</span></span>
<span>      <span class="co"># remotes::install_github("slu-openGIS/postmastr")</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">postmastr</span><span class="op">)</span></span>
<span>      <span class="va">abc</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="va">csv_file</span><span class="op">)</span></span>
<span>      <span class="va">abc</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">pm_identify</span><span class="op">(</span>var <span class="op">=</span> <span class="st">"address"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sushi2</span></span>
<span>      <span class="va">sushi2_min</span> <span class="op">&lt;-</span> <span class="fu">pm_prep</span><span class="op">(</span><span class="va">sushi2</span>, var <span class="op">=</span> <span class="st">"address"</span>, type <span class="op">=</span> <span class="st">"street"</span><span class="op">)</span></span>
<span>      <span class="fu">pm_postal_all</span><span class="op">(</span><span class="va">sushi2_min</span><span class="op">)</span></span>
<span>      <span class="va">sushi2_min</span> <span class="op">&lt;-</span> <span class="fu">pm_postal_parse</span><span class="op">(</span><span class="va">sushi2_min</span><span class="op">)</span></span>
<span>      <span class="va">moDict</span> <span class="op">&lt;-</span> <span class="fu">pm_dictionary</span><span class="op">(</span>locale <span class="op">=</span> <span class="st">"us"</span>, type <span class="op">=</span> <span class="st">"state"</span>, case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"upper"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">moDict</span></span>
<span>      <span class="fu">pm_state_all</span><span class="op">(</span><span class="va">sushi2_min</span>, dictionary <span class="op">=</span> <span class="va">moDict</span><span class="op">)</span> <span class="co">#Checks to make sure that all states have matches</span></span>
<span>      <span class="va">sushi2_min</span> <span class="op">&lt;-</span> <span class="fu">pm_state_parse</span><span class="op">(</span><span class="va">sushi2_min</span>, dictionary <span class="op">=</span> <span class="va">moDict</span><span class="op">)</span></span>
<span>      <span class="fu">pm_house_all</span><span class="op">(</span><span class="va">sushi2_min</span><span class="op">)</span></span>
<span>      <span class="va">sushi2_min</span> <span class="op">&lt;-</span> <span class="fu">pm_house_parse</span><span class="op">(</span><span class="va">sushi2_min</span><span class="op">)</span></span>
<span>      <span class="va">sushi2_min</span> <span class="op">&lt;-</span> <span class="fu">pm_streetDir_parse</span><span class="op">(</span><span class="va">sushi2_min</span><span class="op">)</span></span>
<span>      <span class="va">sushi2_min</span> <span class="op">&lt;-</span> <span class="fu">pm_streetSuf_parse</span><span class="op">(</span><span class="va">sushi2_min</span><span class="op">)</span></span>
<span>      <span class="va">sushi2_min</span> <span class="op">&lt;-</span> <span class="fu">pm_street_parse</span><span class="op">(</span><span class="va">sushi2_min</span>, ordinal <span class="op">=</span> <span class="cn">TRUE</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="va">sushi2_parsed</span> <span class="op">&lt;-</span> <span class="fu">pm_replace</span><span class="op">(</span><span class="va">sushi2_min</span>, source <span class="op">=</span> <span class="va">sushi2</span><span class="op">)</span></span>
<span>      <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">sushi2_parsed</span>, <span class="st">"~/Dropbox (Personal)/workforce/Master_References/NPPES/NPPES_November_filtered_data_address_parsed.csv"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The validate_and_remove_invalid_npi function is a handy tool for
cleaning and validating datasets with NPI numbers. By following the
steps outlined in this vignette, you can ensure that your data contains
only valid NPIs for further analysis and processing.</p>
</div>
<div class="section level2">
<h2 id="features-and-bugs">Features and bugs<a class="anchor" aria-label="anchor" href="#features-and-bugs"></a>
</h2>
<p>If you have ideas for other features that would make name handling
easier, or find a bug, the best approach is to either report it or add
it!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tyler Muffly.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
